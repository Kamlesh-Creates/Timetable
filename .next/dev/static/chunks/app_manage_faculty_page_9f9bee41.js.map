{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Timetable/app/manage/faculty/page.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nconst PAGE_SIZE = 10;\r\n\r\nexport default function FacultyListPage() {\r\n  const [teachers, setTeachers] = useState([]);\r\n  const [query, setQuery] = useState(\"\");\r\n  const [sortKey, setSortKey] = useState(\"name\");\r\n  const [page, setPage] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    async function loadTeachers() {\r\n      setLoading(true);\r\n      setError(\"\");\r\n      try {\r\n        const res = await fetch(\"/api/admin/teachers\");\r\n        const data = await res.json();\r\n        if (!res.ok) {\r\n          setError(data.message || \"Failed to load faculty\");\r\n          return;\r\n        }\r\n        setTeachers(data.teachers || []);\r\n      } catch (err) {\r\n        setError(\"Something went wrong while loading faculty.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    loadTeachers();\r\n  }, []);\r\n\r\n  const filtered = useMemo(() => {\r\n    const q = query.toLowerCase();\r\n    return [...teachers]\r\n      .filter((t) => t.name.toLowerCase().includes(q))\r\n      .sort((a, b) => {\r\n        return (a[sortKey] || \"\").localeCompare(b[sortKey] || \"\");\r\n      });\r\n  }, [teachers, query, sortKey]);\r\n\r\n  const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));\r\n  const currentPage = Math.min(page, totalPages);\r\n  const pageRows = filtered.slice(\r\n    (currentPage - 1) * PAGE_SIZE,\r\n    currentPage * PAGE_SIZE\r\n  );\r\n\r\n  async function handleDelete(id, name) {\r\n    if (\r\n      !window.confirm(\r\n        `Are you sure you want to delete faculty member \"${name}\"? This cannot be undone.`\r\n      )\r\n    ) {\r\n      return;\r\n    }\r\n    try {\r\n      const res = await fetch(`/api/admin/teachers/${id}`, {\r\n        method: \"DELETE\",\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) {\r\n        alert(data.message || \"Failed to delete faculty member\");\r\n        return;\r\n      }\r\n      setTeachers((prev) => prev.filter((t) => t._id !== id));\r\n    } catch (err) {\r\n      alert(\"Something went wrong while deleting the faculty member.\");\r\n    }\r\n  }\r\n\r\n  function handleExportCsv() {\r\n    const header = [\"Name\", \"Subjects\"];\r\n    const lines = [\r\n      header.join(\",\"),\r\n      ...filtered.map((t) => [\r\n        t.name,\r\n        (t.subjects || []).map((s) => (s.name || s)).join(\"; \"),\r\n      ].join(\",\")),\r\n    ];\r\n    const blob = new Blob([lines.join(\"\\n\")], { type: \"text/csv;charset=utf-8\" });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"faculty.csv\";\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  return (\r\n    <main className=\"mx-auto max-w-6xl px-4 py-6\">\r\n      <header className=\"mb-4 flex flex-col justify-between gap-3 sm:flex-row sm:items-center\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-semibold text-slate-900\">Faculty</h1>\r\n          <p className=\"text-sm text-slate-600\">\r\n            Manage teachers and their assigned subjects.\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleExportCsv}\r\n            className=\"rounded-md border border-[#CBD5E1] bg-slate-50 px-3 py-2 text-xs font-medium text-slate-700 hover:bg-slate-100\"\r\n          >\r\n            Export CSV\r\n          </button>\r\n          <Link\r\n            href=\"/manage/faculty/new\"\r\n            className=\"rounded-md bg-[#1A4C8B] px-3 py-2 text-xs font-medium text-white hover:bg-blue-800\"\r\n          >\r\n            Add faculty\r\n          </Link>\r\n        </div>\r\n      </header>\r\n\r\n      <section className=\"rounded-lg bg-white p-4 shadow-sm ring-1 ring-[#E5E7EB]\">\r\n        <div className=\"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\r\n          <div className=\"flex-1\">\r\n            <input\r\n              type=\"search\"\r\n              value={query}\r\n              onChange={(e) => {\r\n                setQuery(e.target.value);\r\n                setPage(1);\r\n              }}\r\n              placeholder=\"Search by faculty name…\"\r\n              className=\"block w-full rounded-md border border-[#CBD5E1] bg-white px-3 py-2 text-sm text-slate-900 outline-none ring-2 ring-transparent focus:border-[#1A4C8B] focus:ring-[#BFDBFE]\"\r\n            />\r\n          </div>\r\n          <div className=\"flex items-center gap-2 text-xs text-slate-600\">\r\n            <span>Sort by</span>\r\n            <select\r\n              value={sortKey}\r\n              onChange={(e) => setSortKey(e.target.value)}\r\n              className=\"rounded-md border border-[#CBD5E1] bg-white px-2 py-1 text-xs text-slate-900 outline-none focus:border-[#1A4C8B] focus:ring-1 focus:ring-[#BFDBFE]\"\r\n            >\r\n              <option value=\"name\">Name</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        {error && (\r\n          <p className=\"mb-3 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm font-medium text-red-700\">\r\n            {error}\r\n          </p>\r\n        )}\r\n\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full text-left text-sm\">\r\n            <thead className=\"border-b border-[#E5E7EB] bg-[#F8FAFC] text-xs font-medium text-slate-600\">\r\n              <tr>\r\n                <th className=\"px-3 py-2\">Name</th>\r\n                <th className=\"px-3 py-2\">Subjects</th>\r\n                <th className=\"px-3 py-2 text-right\">Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-[#E5E7EB]\">\r\n              {loading ? (\r\n                <tr>\r\n                  <td\r\n                    colSpan={3}\r\n                    className=\"px-3 py-4 text-center text-sm text-slate-500\"\r\n                  >\r\n                    Loading faculty…\r\n                  </td>\r\n                </tr>\r\n              ) : pageRows.length === 0 ? (\r\n                <tr>\r\n                  <td\r\n                    colSpan={3}\r\n                    className=\"px-3 py-4 text-center text-sm text-slate-500\"\r\n                  >\r\n                    No faculty members found.\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                pageRows.map((t) => (\r\n                  <tr key={t._id}>\r\n                    <td className=\"px-3 py-2 text-slate-900\">{t.name}</td>\r\n                    <td className=\"px-3 py-2 text-slate-700\">\r\n                      {t.subjects && t.subjects.length > 0\r\n                        ? t.subjects.map((s) => (s.name || s)).join(\", \")\r\n                        : \"—\"}\r\n                    </td>\r\n                    <td className=\"px-3 py-2 text-right text-xs\">\r\n                      <Link\r\n                        href={`/manage/faculty/${t._id}`}\r\n                        className=\"mr-2 text-[#1A4C8B] hover:underline\"\r\n                      >\r\n                        Edit\r\n                      </Link>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => handleDelete(t._id, t.name)}\r\n                        className=\"text-red-600 hover:underline\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"mt-3 flex items-center justify-between text-xs text-slate-600\">\r\n          <span>\r\n            Page {currentPage} of {totalPages}\r\n          </span>\r\n          <div className=\"space-x-2\">\r\n            <button\r\n              type=\"button\"\r\n              disabled={currentPage === 1}\r\n              onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n              className=\"rounded-md border border-[#CBD5E1] bg-white px-2 py-1 disabled:opacity-50\"\r\n            >\r\n              Previous\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              disabled={currentPage === totalPages}\r\n              onClick={() => setPage((p) => Math.min(totalPages, p + 1))}\r\n              className=\"rounded-md border border-[#CBD5E1] bg-white px-2 py-1 disabled:opacity-50\"\r\n            >\r\n              Next\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}