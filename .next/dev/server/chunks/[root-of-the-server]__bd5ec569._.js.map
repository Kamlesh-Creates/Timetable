{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/Fullstacks/timetable2026/Timetable/lib/db.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\"Please define the MONGODB_URI environment variable\");\r\n}\r\n\r\nlet cached = global._mongoose;\r\n\r\nif (!cached) {\r\n  cached = global._mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    cached.promise = mongoose\r\n      .connect(MONGODB_URI, {\r\n        dbName: process.env.MONGODB_DB || \"timetable\",\r\n      })\r\n      .then((mongooseInstance) => mongooseInstance);\r\n  }\r\n\r\n  cached.conn = await cached.promise;\r\n  return cached.conn;\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI,SAAS,yDAAO,SAAS;AAE7B,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAO,SAAS,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAC1D;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,OAAO,GAAG,oHAAQ,CACtB,OAAO,CAAC,aAAa;YACpB,QAAQ,QAAQ,GAAG,CAAC,UAAU,IAAI;QACpC,GACC,IAAI,CAAC,CAAC,mBAAqB;IAChC;IAEA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///D:/Fullstacks/timetable2026/Timetable/models/Timetable.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst timetableSchema = new mongoose.Schema(\r\n  {\r\n    data: { type: Object, required: true },\r\n    result: { type: Object },\r\n    generatedAt: { type: Date, default: Date.now },\r\n    divisions: [{ type: String }],\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nif (mongoose.models.Timetable) {\r\n  delete mongoose.models.Timetable;\r\n}\r\n\r\nexport default mongoose.model(\"Timetable\", timetableSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB,IAAI,oHAAQ,CAAC,MAAM,CACzC;IACE,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,QAAQ;QAAE,MAAM;IAAO;IACvB,aAAa;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;IAC7C,WAAW;QAAC;YAAE,MAAM;QAAO;KAAE;AAC/B,GACA;IAAE,YAAY;AAAK;AAGrB,IAAI,oHAAQ,CAAC,MAAM,CAAC,SAAS,EAAE;IAC7B,OAAO,oHAAQ,CAAC,MAAM,CAAC,SAAS;AAClC;uCAEe,oHAAQ,CAAC,KAAK,CAAC,aAAa"}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///D:/Fullstacks/timetable2026/Timetable/models/Setting.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst settingSchema = new mongoose.Schema(\r\n  {\r\n    days: [{ type: String, trim: true }], // e.g. [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\"]\r\n    start_hour: { type: Number, min: 0, max: 23 }, // e.g. 9\r\n    end_hour: { type: Number, min: 0, max: 23 }, // e.g. 17\r\n    lunch_start_hour: { type: Number, min: 0, max: 23 }, // e.g. 12\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nconst Setting =\r\n  mongoose.models.Setting || mongoose.model(\"Setting\", settingSchema);\r\n\r\nexport default Setting;\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,oHAAQ,CAAC,MAAM,CACvC;IACE,MAAM;QAAC;YAAE,MAAM;YAAQ,MAAM;QAAK;KAAE;IACpC,YAAY;QAAE,MAAM;QAAQ,KAAK;QAAG,KAAK;IAAG;IAC5C,UAAU;QAAE,MAAM;QAAQ,KAAK;QAAG,KAAK;IAAG;IAC1C,kBAAkB;QAAE,MAAM;QAAQ,KAAK;QAAG,KAAK;IAAG;AACpD,GACA;IAAE,YAAY;AAAK;AAGrB,MAAM,UACJ,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAC,WAAW;uCAExC"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///D:/Fullstacks/timetable2026/Timetable/app/api/timetable/%5Bid%5D/pdf/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { connectToDatabase } from \"../../../../../lib/db\";\r\nimport Timetable from \"../../../../../models/Timetable\";\r\nimport Setting from \"../../../../../models/Setting\";\r\n\r\nconst PYTHON_API_URL = process.env.PYTHON_API_URL || \"http://localhost:8000\";\r\n\r\nexport async function GET(request, { params }) {\r\n  const resolvedParams = await params;\r\n  const { id } = resolvedParams || {};\r\n  const searchParams = new URL(request.url).searchParams;\r\n  const division = searchParams.get(\"division\");\r\n\r\n  if (!id) {\r\n    return NextResponse.json(\r\n      { message: \"Timetable id is required\" },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  if (!division) {\r\n    return NextResponse.json(\r\n      { message: \"Query parameter 'division' is required\" },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const [timetableDoc, settings] = await Promise.all([\r\n      Timetable.findById(id),\r\n      Setting.findOne(),\r\n    ]);\r\n\r\n    if (!timetableDoc) {\r\n      return NextResponse.json(\r\n        { message: \"Timetable not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    if (!settings) {\r\n      return NextResponse.json(\r\n        { message: \"Settings not configured\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const rawPayload =\r\n      timetableDoc.result && Object.keys(timetableDoc.result).length > 0\r\n        ? timetableDoc.result\r\n        : timetableDoc.data || {};\r\n\r\n    const timetablePayload =\r\n      rawPayload.timetable && typeof rawPayload.timetable === \"object\"\r\n        ? rawPayload.timetable\r\n        : rawPayload;\r\n\r\n    const trimmedDivision = division.trim();\r\n    const keys = Object.keys(timetablePayload || {});\r\n\r\n    // Try to match requested division; if not found, fall back to first available\r\n    const matchedKey =\r\n      keys.find(\r\n        (key) => key.trim().toLowerCase() === trimmedDivision.toLowerCase()\r\n      ) || keys[0];\r\n\r\n    // Filter timetable to only include the requested division\r\n    const filteredTimetable = {\r\n      [matchedKey]: timetablePayload[matchedKey]\r\n    };\r\n\r\n    // Send timetable data and settings to Python API for PDF generation\r\n    const pythonResponse = await fetch(`${PYTHON_API_URL}/generate-pdf`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        timetable: filteredTimetable,\r\n        settings: {\r\n          days: settings.days,\r\n          start_hour: settings.start_hour,\r\n          end_hour: settings.end_hour,\r\n          lunch_start_hour: settings.lunch_start_hour,\r\n        },\r\n      }),\r\n    });\r\n\r\n    if (!pythonResponse.ok) {\r\n      const errorText = await pythonResponse.text();\r\n      console.error(\"[PDF] Python API error:\", errorText);\r\n      return NextResponse.json(\r\n        {\r\n          message: `Python PDF server returned an error: ${pythonResponse.status}`,\r\n          details: errorText,\r\n        },\r\n        { status: 502 }\r\n      );\r\n    }\r\n\r\n    // Get PDF buffer from Python API\r\n    const pdfBuffer = await pythonResponse.arrayBuffer();\r\n\r\n    return new NextResponse(pdfBuffer, {\r\n      status: 200,\r\n      headers: {\r\n        \"Content-Type\": \"application/pdf\",\r\n        \"Content-Disposition\": `attachment; filename=\"timetable-${division}.pdf\"`,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\"[Timetable PDF] generation failed:\", error);\r\n    return NextResponse.json(\r\n      { message: \"Failed to generate PDF\", error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}