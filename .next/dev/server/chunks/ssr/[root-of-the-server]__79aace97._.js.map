{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/Timetable%20Project/app/manage/classrooms/page.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nconst PAGE_SIZE = 10;\r\n\r\nexport default function ClassroomsPage() {\r\n  const [classrooms, setClassrooms] = useState([]);\r\n  const [query, setQuery] = useState(\"\");\r\n  const [sortKey, setSortKey] = useState(\"name\");\r\n  const [page, setPage] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    async function loadClassrooms() {\r\n      setLoading(true);\r\n      setError(\"\");\r\n      try {\r\n        const res = await fetch(\"/api/admin/classrooms\");\r\n        const data = await res.json();\r\n        if (!res.ok) {\r\n          setError(data.message || \"Failed to load classrooms\");\r\n          return;\r\n        }\r\n        setClassrooms(data.classrooms || []);\r\n      } catch (err) {\r\n        setError(\"Something went wrong while loading classrooms.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    loadClassrooms();\r\n  }, []);\r\n\r\n  const filtered = useMemo(() => {\r\n    const q = query.toLowerCase();\r\n    return [...classrooms]\r\n      .filter((c) => c.name.toLowerCase().includes(q))\r\n      .sort((a, b) => {\r\n        return (a[sortKey] || \"\").localeCompare(b[sortKey] || \"\");\r\n      });\r\n  }, [classrooms, query, sortKey]);\r\n\r\n  const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));\r\n  const currentPage = Math.min(page, totalPages);\r\n  const pageRows = filtered.slice(\r\n    (currentPage - 1) * PAGE_SIZE,\r\n    currentPage * PAGE_SIZE\r\n  );\r\n\r\n  async function handleDelete(id, name) {\r\n    if (\r\n      !window.confirm(\r\n        `Are you sure you want to delete classroom \"${name}\"? This cannot be undone.`\r\n      )\r\n    ) {\r\n      return;\r\n    }\r\n    try {\r\n      const res = await fetch(`/api/admin/classrooms/${id}`, {\r\n        method: \"DELETE\",\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) {\r\n        alert(data.message || \"Failed to delete classroom\");\r\n        return;\r\n      }\r\n      setClassrooms((prev) => prev.filter((c) => c._id !== id));\r\n    } catch (err) {\r\n      alert(\"Something went wrong while deleting the classroom.\");\r\n    }\r\n  }\r\n\r\n  function handleExportCsv() {\r\n    const header = [\"Name\", \"Subjects\"];\r\n    const lines = [\r\n      header.join(\",\"),\r\n      ...filtered.map((c) => [\r\n        c.name,\r\n        (c.subjects || []).map((s) => s.name || s).join(\"; \"),\r\n      ].join(\",\")),\r\n    ];\r\n    const blob = new Blob([lines.join(\"\\n\")], { type: \"text/csv;charset=utf-8\" });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"classrooms.csv\";\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  return (\r\n    <main className=\"mx-auto max-w-6xl px-4 py-6\">\r\n      <header className=\"mb-4 flex flex-col justify-between gap-3 sm:flex-row sm:items-center\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-semibold text-slate-900\">Classrooms</h1>\r\n          <p className=\"text-sm text-slate-600\">\r\n            Manage classrooms and their assigned subjects.\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleExportCsv}\r\n            className=\"rounded-md border border-[#CBD5E1] bg-slate-50 px-3 py-2 text-xs font-medium text-slate-700 hover:bg-slate-100\"\r\n          >\r\n            Export CSV\r\n          </button>\r\n          <Link\r\n            href=\"/manage/classrooms/new\"\r\n            className=\"rounded-md bg-[#1A4C8B] px-3 py-2 text-xs font-medium text-white hover:bg-blue-800\"\r\n          >\r\n            New classroom\r\n          </Link>\r\n        </div>\r\n      </header>\r\n\r\n      <section className=\"rounded-lg bg-white p-4 shadow-sm ring-1 ring-[#E5E7EB]\">\r\n        <div className=\"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\r\n          <div className=\"flex-1\">\r\n            <input\r\n              type=\"search\"\r\n              value={query}\r\n              onChange={(e) => {\r\n                setQuery(e.target.value);\r\n                setPage(1);\r\n              }}\r\n              placeholder=\"Search by classroom name…\"\r\n              className=\"block w-full rounded-md border border-[#CBD5E1] bg-white px-3 py-2 text-sm text-slate-900 outline-none ring-2 ring-transparent focus:border-[#1A4C8B] focus:ring-[#BFDBFE]\"\r\n            />\r\n          </div>\r\n          <div className=\"flex items-center gap-2 text-xs text-slate-600\">\r\n            <span>Sort by</span>\r\n            <select\r\n              value={sortKey}\r\n              onChange={(e) => setSortKey(e.target.value)}\r\n              className=\"rounded-md border border-[#CBD5E1] bg-white px-2 py-1 text-xs text-slate-900 outline-none focus:border-[#1A4C8B] focus:ring-1 focus:ring-[#BFDBFE]\"\r\n            >\r\n              <option value=\"name\">Name</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        {error && (\r\n          <p className=\"mb-3 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm font-medium text-red-700\">\r\n            {error}\r\n          </p>\r\n        )}\r\n\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full text-left text-sm\">\r\n            <thead className=\"border-b border-[#E5E7EB] bg-[#F8FAFC] text-xs font-medium text-slate-600\">\r\n              <tr>\r\n                <th className=\"px-3 py-2\">Name</th>\r\n                <th className=\"px-3 py-2\">Subjects</th>\r\n                <th className=\"px-3 py-2 text-right\">Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-[#E5E7EB]\">\r\n              {loading ? (\r\n                <tr>\r\n                  <td\r\n                    colSpan={3}\r\n                    className=\"px-3 py-4 text-center text-sm text-slate-500\"\r\n                  >\r\n                    Loading classrooms…\r\n                  </td>\r\n                </tr>\r\n              ) : pageRows.length === 0 ? (\r\n                <tr>\r\n                  <td\r\n                    colSpan={3}\r\n                    className=\"px-3 py-4 text-center text-sm text-slate-500\"\r\n                  >\r\n                    No classrooms found.\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                pageRows.map((c) => (\r\n                  <tr key={c._id}>\r\n                    <td className=\"px-3 py-2 text-slate-900\">{c.name}</td>\r\n                    <td className=\"px-3 py-2 text-slate-700\">\r\n                      {c.subjects && c.subjects.length > 0\r\n                        ? c.subjects.map((s) => s.name || s).join(\", \")\r\n                        : \"—\"}\r\n                    </td>\r\n                    <td className=\"px-3 py-2 text-right text-xs\">\r\n                      <Link\r\n                        href={`/manage/classrooms/${c._id}`}\r\n                        className=\"mr-2 text-[#1A4C8B] hover:underline\"\r\n                      >\r\n                        Edit\r\n                      </Link>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => handleDelete(c._id, c.name)}\r\n                        className=\"text-red-600 hover:underline\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"mt-3 flex items-center justify-between text-xs text-slate-600\">\r\n          <span>\r\n            Page {currentPage} of {totalPages}\r\n          </span>\r\n          <div className=\"space-x-2\">\r\n            <button\r\n              type=\"button\"\r\n              disabled={currentPage === 1}\r\n              onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n              className=\"rounded-md border border-[#CBD5E1] bg-white px-2 py-1 disabled:opacity-50\"\r\n            >\r\n              Previous\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              disabled={currentPage === totalPages}\r\n              onClick={() => setPage((p) => Math.min(totalPages, p + 1))}\r\n              className=\"rounded-md border border-[#CBD5E1] bg-white px-2 py-1 disabled:opacity-50\"\r\n            >\r\n              Next\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}