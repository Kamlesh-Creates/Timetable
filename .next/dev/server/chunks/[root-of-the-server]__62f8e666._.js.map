{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/Fullstacks/timetable/Timetable/app/api/timetable/pdf/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport puppeteer from \"puppeteer\";\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    const { timetableData } = await request.json();\r\n\r\n    if (!timetableData) {\r\n      return NextResponse.json(\r\n        { message: \"Timetable data is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Build HTML string\r\n    let html = `\r\n      <html>\r\n        <head>\r\n          <style>\r\n            body { \r\n              font-family: Arial, sans-serif; \r\n              padding: 20px; \r\n            }\r\n            h1 { \r\n              text-align: center; \r\n              margin-bottom: 30px;\r\n              color: #333;\r\n            }\r\n            h2 { \r\n              text-align: center; \r\n              margin-top: 40px;\r\n              margin-bottom: 15px;\r\n              color: #2c3e50;\r\n              page-break-before: always;\r\n            }\r\n            h2:first-of-type {\r\n              page-break-before: auto;\r\n            }\r\n            table { \r\n              border-collapse: collapse; \r\n              width: 100%; \r\n              margin-bottom: 50px;\r\n            }\r\n            th, td { \r\n              border: 1px solid #333; \r\n              padding: 10px; \r\n              text-align: center; \r\n              font-size: 11px;\r\n              vertical-align: middle;\r\n            }\r\n            th { \r\n              background-color: #34495e;\r\n              color: white;\r\n              font-weight: bold;\r\n              font-size: 12px;\r\n            }\r\n            th.day-header {\r\n              background-color: #2c3e50;\r\n            }\r\n            td.free { \r\n              background-color: #ecf0f1;\r\n              color: #95a5a6;\r\n              font-style: italic;\r\n            }\r\n            td.lunch { \r\n              background-color: #f39c12;\r\n              color: white;\r\n              font-weight: bold;\r\n            }\r\n            .subject-name {\r\n              font-weight: bold;\r\n              color: #2c3e50;\r\n              font-size: 12px;\r\n              margin-bottom: 4px;\r\n            }\r\n            .teacher-name {\r\n              color: #555;\r\n              font-size: 10px;\r\n              margin-bottom: 2px;\r\n            }\r\n            .room-name {\r\n              color: #777;\r\n              font-size: 9px;\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <h1>College Timetable</h1>\r\n    `;\r\n\r\n    // Process each division\r\n    for (const division in timetableData) {\r\n      html += `<h2>Division: ${division}</h2>`;\r\n      html += `<table>`;\r\n      \r\n      // Get days from the division data\r\n      const days = Object.keys(timetableData[division]);\r\n      const numSlots = timetableData[division][days[0]].length;\r\n      \r\n      // Create header row with Time Slot and Days\r\n      html += `<tr><th>Time Slot</th>`;\r\n      for (const day of days) {\r\n        html += `<th class=\"day-header\">${day}</th>`;\r\n      }\r\n      html += `</tr>`;\r\n\r\n      // Create rows for each time slot\r\n      for (let slot = 0; slot < numSlots; slot++) {\r\n        html += `<tr>`;\r\n        html += `<td><strong>Slot ${slot + 1}</strong></td>`;\r\n\r\n        // Add cell for each day\r\n        for (const day of days) {\r\n          const entry = timetableData[division][day][slot];\r\n          let cellClass = \"\";\r\n          let cellContent = \"\";\r\n\r\n          if (entry.class === \"FREE\") {\r\n            cellClass = \"free\";\r\n            cellContent = \"FREE\";\r\n          } else if (entry.class === \"LUNCH\") {\r\n            cellClass = \"lunch\";\r\n            cellContent = \"LUNCH BREAK\";\r\n          } else {\r\n            // Regular class entry with subject, teacher, and classroom\r\n            cellContent = `\r\n              <div class=\"subject-name\">${entry.class || \"N/A\"}</div>\r\n              ${entry.teacher ? `<div class=\"teacher-name\">${entry.teacher}</div>` : \"\"}\r\n              ${entry.room ? `<div class=\"room-name\">${entry.room}</div>` : \"\"}\r\n            `;\r\n          }\r\n\r\n          html += `<td class=\"${cellClass}\">${cellContent}</td>`;\r\n        }\r\n\r\n        html += `</tr>`;\r\n      }\r\n\r\n      html += `</table>`;\r\n    }\r\n\r\n    html += `</body></html>`;\r\n\r\n    // Launch Puppeteer and generate PDF\r\n    const browser = await puppeteer.launch({\r\n      headless: true,\r\n      args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"],\r\n    });\r\n    const page = await browser.newPage();\r\n    await page.setContent(html, { waitUntil: \"networkidle0\" });\r\n    const pdfBuffer = await page.pdf({\r\n      format: \"A4\",\r\n      printBackground: true,\r\n      landscape: true,\r\n      margin: {\r\n        top: \"20px\",\r\n        right: \"20px\",\r\n        bottom: \"20px\",\r\n        left: \"20px\",\r\n      },\r\n    });\r\n\r\n    await browser.close();\r\n\r\n    // Return PDF as response\r\n    return new NextResponse(pdfBuffer, {\r\n      status: 200,\r\n      headers: {\r\n        \"Content-Type\": \"application/pdf\",\r\n        \"Content-Disposition\": \"attachment; filename=timetable.pdf\",\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\"[PDF] Generation error:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        message: \"Failed to generate PDF\",\r\n        error: error.message,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}