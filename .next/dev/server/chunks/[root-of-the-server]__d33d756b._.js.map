{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Fullstacks/timetable2026/Timetable/app/api/timetable/faculty-pdf/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\n\r\nconst PYTHON_API_URL = process.env.PYTHON_API_URL || \"http://localhost:8000\";\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Call Python API to generate faculty timetable\r\n    const response = await fetch(`${PYTHON_API_URL}/generate-faculty-timetable`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error(\"[Faculty Timetable] Python API error:\", errorText);\r\n      return NextResponse.json(\r\n        {\r\n          message: `Failed to generate faculty timetable: ${response.status} ${response.statusText}`,\r\n          details: errorText,\r\n        },\r\n        { status: 502 }\r\n      );\r\n    }\r\n\r\n    const data = await response.json();\r\n    const facultyTimetable = data.faculty_timetable || data;\r\n\r\n    // Generate HTML for faculty timetable\r\n    const html = generateFacultyTimetableHTML(facultyTimetable);\r\n\r\n    // Return HTML as response (frontend will handle PDF generation via print)\r\n    return new NextResponse(html, {\r\n      headers: {\r\n        \"Content-Type\": \"text/html\",\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\"[Faculty Timetable] Error:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        message: \"Failed to generate faculty timetable\",\r\n        error: error.message,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nfunction generateFacultyTimetableHTML(facultyTimetable) {\r\n  let html = `\r\n    <!DOCTYPE html>\r\n    <html>\r\n      <head>\r\n        <meta charset=\"UTF-8\">\r\n        <title>Faculty Timetable</title>\r\n        <style>\r\n          @media print {\r\n            body { margin: 0; }\r\n            .page-break { page-break-before: always; }\r\n          }\r\n          body {\r\n            font-family: Arial, sans-serif;\r\n            padding: 20px;\r\n            line-height: 1.4;\r\n          }\r\n          h1 {\r\n            text-align: center;\r\n            margin-bottom: 30px;\r\n            color: #1A4C8B;\r\n            font-size: 24px;\r\n          }\r\n          h2 {\r\n            margin-top: 40px;\r\n            text-align: center;\r\n            color: #2c3e50;\r\n            font-size: 20px;\r\n            padding: 10px;\r\n            background-color: #f0f4f8;\r\n            border-radius: 5px;\r\n          }\r\n          .page-break {\r\n            margin-top: 40px;\r\n          }\r\n          table {\r\n            border-collapse: collapse;\r\n            width: 100%;\r\n            margin-bottom: 30px;\r\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\r\n          }\r\n          th, td {\r\n            border: 1px solid #333;\r\n            padding: 10px;\r\n            text-align: center;\r\n            font-size: 11px;\r\n          }\r\n          th {\r\n            background-color: #1A4C8B;\r\n            color: white;\r\n            font-weight: bold;\r\n            font-size: 12px;\r\n          }\r\n          th.day-header {\r\n            background-color: #2c3e50;\r\n            font-size: 13px;\r\n          }\r\n          td.free {\r\n            background-color: #ecf0f1;\r\n            color: #7f8c8d;\r\n            font-style: italic;\r\n          }\r\n          td.lunch {\r\n            background-color: #f39c12;\r\n            color: white;\r\n            font-weight: bold;\r\n          }\r\n          td.occupied {\r\n            background-color: #d6eaf8;\r\n          }\r\n          .subject {\r\n            font-weight: bold;\r\n            font-size: 12px;\r\n            color: #1A4C8B;\r\n          }\r\n          .division {\r\n            font-size: 10px;\r\n            color: #555;\r\n            margin-top: 3px;\r\n          }\r\n          .room {\r\n            font-size: 9px;\r\n            color: #777;\r\n            margin-top: 2px;\r\n          }\r\n          .no-data {\r\n            text-align: center;\r\n            padding: 40px;\r\n            color: #999;\r\n            font-style: italic;\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <h1>Faculty/Teacher Timetable</h1>\r\n  `;\r\n\r\n  if (!facultyTimetable || Object.keys(facultyTimetable).length === 0) {\r\n    html += '<div class=\"no-data\">No faculty timetable data available.</div>';\r\n  } else {\r\n    let teacherIndex = 0;\r\n    \r\n    // Iterate through each teacher\r\n    for (const teacherName in facultyTimetable) {\r\n      if (teacherIndex > 0) {\r\n        html += '<div class=\"page-break\"></div>';\r\n      }\r\n      \r\n      html += `<h2>Faculty: ${teacherName}</h2>`;\r\n      \r\n      const schedule = facultyTimetable[teacherName];\r\n      \r\n      if (!schedule || Object.keys(schedule).length === 0) {\r\n        html += '<div class=\"no-data\">No schedule available for this faculty member.</div>';\r\n        teacherIndex++;\r\n        continue;\r\n      }\r\n\r\n      // Get days and slots\r\n      const days = Object.keys(schedule);\r\n      const firstDay = days[0];\r\n      const slots = schedule[firstDay] || [];\r\n      const slotsCount = slots.length;\r\n\r\n      html += '<table>';\r\n      \r\n      // Header row with time slots\r\n      html += '<tr><th class=\"day-header\">Day / Time</th>';\r\n      for (let i = 0; i < slotsCount; i++) {\r\n        html += `<th>Slot ${i + 1}</th>`;\r\n      }\r\n      html += '</tr>';\r\n\r\n      // Rows for each day\r\n      for (const day of days) {\r\n        html += `<tr><th class=\"day-header\">${day}</th>`;\r\n        const daySlots = schedule[day] || [];\r\n        \r\n        for (const slot of daySlots) {\r\n          if (!slot || slot === \"Free\" || slot === \"\") {\r\n            html += '<td class=\"free\">Free</td>';\r\n          } else if (typeof slot === \"string\" && slot.toLowerCase().includes(\"lunch\")) {\r\n            html += '<td class=\"lunch\">Lunch Break</td>';\r\n          } else if (typeof slot === \"object\") {\r\n            // Slot contains subject, division, room info\r\n            const subject = slot.subject || slot.Subject || \"\";\r\n            const division = slot.division || slot.Division || \"\";\r\n            const room = slot.room || slot.Room || \"\";\r\n            \r\n            html += '<td class=\"occupied\">';\r\n            if (subject) {\r\n              html += `<div class=\"subject\">${subject}</div>`;\r\n            }\r\n            if (division) {\r\n              html += `<div class=\"division\">Division: ${division}</div>`;\r\n            }\r\n            if (room) {\r\n              html += `<div class=\"room\">Room: ${room}</div>`;\r\n            }\r\n            html += '</td>';\r\n          } else {\r\n            // Plain string with subject name\r\n            html += `<td class=\"occupied\"><div class=\"subject\">${slot}</div></td>`;\r\n          }\r\n        }\r\n        \r\n        html += '</tr>';\r\n      }\r\n      \r\n      html += '</table>';\r\n      teacherIndex++;\r\n    }\r\n  }\r\n\r\n  html += `\r\n      </body>\r\n    </html>\r\n  `;\r\n\r\n  return html;\r\n}\r\n"],"names":[],"mappings":"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"}}]
}