{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Fullstacks/timetable2026/Timetable/app/api/timetable/free-slots-pdf/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\n\r\nconst PYTHON_API_URL = process.env.PYTHON_API_URL || \"http://localhost:8000\";\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Call Python API to generate free slots\r\n    const response = await fetch(`${PYTHON_API_URL}/generate-free-slots`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error(\"[Free Slots] Python API error:\", errorText);\r\n      return NextResponse.json(\r\n        {\r\n          message: `Failed to generate free slots: ${response.status} ${response.statusText}`,\r\n          details: errorText,\r\n        },\r\n        { status: 502 }\r\n      );\r\n    }\r\n\r\n    const data = await response.json();\r\n    const freeSlots = data.free_slots || data;\r\n\r\n    // Generate HTML for free slots\r\n    const html = generateFreeSlotsHTML(freeSlots);\r\n\r\n    // Return HTML as response (frontend will handle PDF generation via print)\r\n    return new NextResponse(html, {\r\n      headers: {\r\n        \"Content-Type\": \"text/html\",\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\"[Free Slots] Error:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        message: \"Failed to generate free slots\",\r\n        error: error.message,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nfunction generateFreeSlotsHTML(freeSlots) {\r\n  let html = `\r\n    <!DOCTYPE html>\r\n    <html>\r\n      <head>\r\n        <meta charset=\"UTF-8\">\r\n        <title>Free Room Slots</title>\r\n        <style>\r\n          @media print {\r\n            body { margin: 0; }\r\n            .page-break { page-break-before: always; }\r\n          }\r\n          body {\r\n            font-family: Arial, sans-serif;\r\n            padding: 20px;\r\n            line-height: 1.4;\r\n          }\r\n          h1 {\r\n            text-align: center;\r\n            margin-bottom: 30px;\r\n            color: #1A4C8B;\r\n            font-size: 24px;\r\n          }\r\n          h2 {\r\n            margin-top: 40px;\r\n            text-align: center;\r\n            color: #2c3e50;\r\n            font-size: 20px;\r\n            padding: 10px;\r\n            background-color: #f0f4f8;\r\n            border-radius: 5px;\r\n          }\r\n          .page-break {\r\n            margin-top: 40px;\r\n          }\r\n          table {\r\n            border-collapse: collapse;\r\n            width: 100%;\r\n            margin-bottom: 30px;\r\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\r\n          }\r\n          th, td {\r\n            border: 1px solid #333;\r\n            padding: 12px;\r\n            text-align: left;\r\n            font-size: 12px;\r\n          }\r\n          th {\r\n            background-color: #1A4C8B;\r\n            color: white;\r\n            font-weight: bold;\r\n            font-size: 13px;\r\n            width: 120px;\r\n          }\r\n          td {\r\n            background-color: #d4edda;\r\n            color: #155724;\r\n          }\r\n          .time-slot {\r\n            display: inline-block;\r\n            background-color: #28a745;\r\n            color: white;\r\n            padding: 6px 12px;\r\n            margin: 4px;\r\n            border-radius: 4px;\r\n            font-size: 11px;\r\n            font-weight: 500;\r\n          }\r\n          .no-data {\r\n            text-align: center;\r\n            padding: 40px;\r\n            color: #999;\r\n            font-style: italic;\r\n          }\r\n          .no-slots {\r\n            color: #999;\r\n            font-style: italic;\r\n            text-align: center;\r\n          }\r\n          .summary {\r\n            background-color: #e8f4f8;\r\n            padding: 15px;\r\n            margin-bottom: 20px;\r\n            border-radius: 5px;\r\n            border-left: 4px solid #1A4C8B;\r\n          }\r\n          .summary p {\r\n            margin: 5px 0;\r\n            font-size: 13px;\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <h1>Free Room Slots</h1>\r\n  `;\r\n\r\n  if (!freeSlots || Object.keys(freeSlots).length === 0) {\r\n    html += '<div class=\"no-data\">No free slots data available.</div>';\r\n  } else {\r\n    let roomIndex = 0;\r\n    \r\n    // Iterate through each room\r\n    for (const roomName in freeSlots) {\r\n      if (roomIndex > 0) {\r\n        html += '<div class=\"page-break\"></div>';\r\n      }\r\n      \r\n      html += `<h2>Room: ${roomName}</h2>`;\r\n      \r\n      const schedule = freeSlots[roomName];\r\n      \r\n      if (!schedule || Object.keys(schedule).length === 0) {\r\n        html += '<div class=\"no-data\">No schedule available for this room.</div>';\r\n        roomIndex++;\r\n        continue;\r\n      }\r\n\r\n      // Get days and calculate total free slots\r\n      const days = Object.keys(schedule);\r\n      let totalFreeSlots = 0;\r\n      for (const day of days) {\r\n        const daySlots = schedule[day] || [];\r\n        totalFreeSlots += daySlots.length;\r\n      }\r\n\r\n      html += `\r\n        <div class=\"summary\">\r\n          <p><strong>Total Free Slots:</strong> ${totalFreeSlots} slots across ${days.length} days</p>\r\n        </div>\r\n      `;\r\n\r\n      html += '<table>';\r\n      \r\n      // Rows for each day\r\n      for (const day of days) {\r\n        const daySlots = schedule[day] || [];\r\n        \r\n        html += `<tr><th>${day}</th><td>`;\r\n        \r\n        if (daySlots.length === 0) {\r\n          html += '<span class=\"no-slots\">No free slots</span>';\r\n        } else {\r\n          // Display each free time slot as a badge\r\n          for (const timeSlot of daySlots) {\r\n            html += `<span class=\"time-slot\">${timeSlot}</span>`;\r\n          }\r\n        }\r\n        \r\n        html += '</td></tr>';\r\n      }\r\n      \r\n      html += '</table>';\r\n      roomIndex++;\r\n    }\r\n  }\r\n\r\n  html += `\r\n      </body>\r\n    </html>\r\n  `;\r\n\r\n  return html;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI;AAE9C,eAAe;IACpB,IAAI;QACF,yCAAyC;QACzC,MAAM,WAAW,MAAM,MAAM,GAAG,eAAe,oBAAoB,CAAC,EAAE;YACpE,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,kCAAkC;YAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS,CAAC,+BAA+B,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,SAAS,UAAU,EAAE;gBACnF,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,MAAM,YAAY,KAAK,UAAU,IAAI;QAErC,+BAA+B;QAC/B,MAAM,OAAO,sBAAsB;QAEnC,0EAA0E;QAC1E,OAAO,IAAI,gJAAY,CAAC,MAAM;YAC5B,SAAS;gBACP,gBAAgB;YAClB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,MAAM,OAAO;QACtB,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEA,SAAS,sBAAsB,SAAS;IACtC,IAAI,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EA6FZ,CAAC;IAED,IAAI,CAAC,aAAa,OAAO,IAAI,CAAC,WAAW,MAAM,KAAK,GAAG;QACrD,QAAQ;IACV,OAAO;QACL,IAAI,YAAY;QAEhB,4BAA4B;QAC5B,IAAK,MAAM,YAAY,UAAW;YAChC,IAAI,YAAY,GAAG;gBACjB,QAAQ;YACV;YAEA,QAAQ,CAAC,UAAU,EAAE,SAAS,KAAK,CAAC;YAEpC,MAAM,WAAW,SAAS,CAAC,SAAS;YAEpC,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,UAAU,MAAM,KAAK,GAAG;gBACnD,QAAQ;gBACR;gBACA;YACF;YAEA,0CAA0C;YAC1C,MAAM,OAAO,OAAO,IAAI,CAAC;YACzB,IAAI,iBAAiB;YACrB,KAAK,MAAM,OAAO,KAAM;gBACtB,MAAM,WAAW,QAAQ,CAAC,IAAI,IAAI,EAAE;gBACpC,kBAAkB,SAAS,MAAM;YACnC;YAEA,QAAQ,CAAC;;gDAEiC,EAAE,eAAe,cAAc,EAAE,KAAK,MAAM,CAAC;;MAEvF,CAAC;YAED,QAAQ;YAER,oBAAoB;YACpB,KAAK,MAAM,OAAO,KAAM;gBACtB,MAAM,WAAW,QAAQ,CAAC,IAAI,IAAI,EAAE;gBAEpC,QAAQ,CAAC,QAAQ,EAAE,IAAI,SAAS,CAAC;gBAEjC,IAAI,SAAS,MAAM,KAAK,GAAG;oBACzB,QAAQ;gBACV,OAAO;oBACL,yCAAyC;oBACzC,KAAK,MAAM,YAAY,SAAU;wBAC/B,QAAQ,CAAC,wBAAwB,EAAE,SAAS,OAAO,CAAC;oBACtD;gBACF;gBAEA,QAAQ;YACV;YAEA,QAAQ;YACR;QACF;IACF;IAEA,QAAQ,CAAC;;;EAGT,CAAC;IAED,OAAO;AACT"}}]
}