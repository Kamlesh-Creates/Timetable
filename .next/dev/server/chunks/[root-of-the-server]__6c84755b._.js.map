{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///D:/Timetable%20Project/lib/db.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\"Please define the MONGODB_URI environment variable\");\r\n}\r\n\r\nlet cached = global._mongoose;\r\n\r\nif (!cached) {\r\n  cached = global._mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    cached.promise = mongoose\r\n      .connect(MONGODB_URI, {\r\n        dbName: process.env.MONGODB_DB || \"timetable\",\r\n      })\r\n      .then((mongooseInstance) => mongooseInstance);\r\n  }\r\n\r\n  cached.conn = await cached.promise;\r\n  return cached.conn;\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI,SAAS,yDAAO,SAAS;AAE7B,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAO,SAAS,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAC1D;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,OAAO,GAAG,oHAAQ,CACtB,OAAO,CAAC,aAAa;YACpB,QAAQ,QAAQ,GAAG,CAAC,UAAU,IAAI;QACpC,GACC,IAAI,CAAC,CAAC,mBAAqB;IAChC;IAEA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///D:/Timetable%20Project/models/Timetable.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst timetableSchema = new mongoose.Schema(\r\n  {\r\n    data: { type: Object, required: true },\r\n    result: { type: Object },\r\n    generatedAt: { type: Date, default: Date.now },\r\n    divisions: [{ type: String }],\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nif (mongoose.models.Timetable) {\r\n  delete mongoose.models.Timetable;\r\n}\r\n\r\nexport default mongoose.model(\"Timetable\", timetableSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB,IAAI,oHAAQ,CAAC,MAAM,CACzC;IACE,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,QAAQ;QAAE,MAAM;IAAO;IACvB,aAAa;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;IAC7C,WAAW;QAAC;YAAE,MAAM;QAAO;KAAE;AAC/B,GACA;IAAE,YAAY;AAAK;AAGrB,IAAI,oHAAQ,CAAC,MAAM,CAAC,SAAS,EAAE;IAC7B,OAAO,oHAAQ,CAAC,MAAM,CAAC,SAAS;AAClC;uCAEe,oHAAQ,CAAC,KAAK,CAAC,aAAa"}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///D:/Timetable%20Project/lib/timetablePdf.js"],"sourcesContent":["const DEFAULT_DAYS = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\r\nconst DEFAULT_PERIOD_LABELS = [\"P1\", \"P2\", \"P3\", \"P4\", \"P5\", \"P6\", \"P7\", \"P8\"];\r\n\r\nfunction formatDateLabel(rawDate) {\r\n  if (!rawDate) {\r\n    return new Date().toLocaleDateString(\"en-US\", { day: \"2-digit\", month: \"short\", year: \"numeric\" });\r\n  }\r\n  const date = new Date(rawDate);\r\n  if (Number.isNaN(date.getTime())) {\r\n    return rawDate;\r\n  }\r\n  return date.toLocaleDateString(\"en-US\", { day: \"2-digit\", month: \"short\", year: \"numeric\" });\r\n}\r\n\r\nfunction normalizeDivisionData(resultJson, division) {\r\n  const root =\r\n    (resultJson?.result && typeof resultJson.result === \"object\" ? resultJson.result : null) ||\r\n    (typeof resultJson?.divisions === \"object\" && !Array.isArray(resultJson.divisions)\r\n      ? resultJson.divisions\r\n      : null) ||\r\n    resultJson;\r\n\r\n  const divisionData = root?.[division];\r\n  if (!divisionData || typeof divisionData !== \"object\") {\r\n    return [];\r\n  }\r\n\r\n  return Object.entries(divisionData).map(([day, slots]) => ({\r\n    day,\r\n    periods: Array.isArray(slots)\r\n      ? slots.map((slot) => ({\r\n          subject:\r\n            slot?.class ||\r\n            slot?.subject ||\r\n            slot?.name ||\r\n            slot?.course ||\r\n            slot?.title ||\r\n            \"\",\r\n          teacher: slot?.teacher || slot?.faculty || slot?.instructor || \"\",\r\n          room: slot?.room || slot?.classroom || slot?.location || \"\",\r\n          isLunch: (slot?.class || slot?.subject || \"\").toUpperCase() === \"LUNCH\",\r\n          isFree: (slot?.class || slot?.subject || \"\").toUpperCase() === \"FREE\",\r\n        }))\r\n      : [],\r\n  }));\r\n}\r\n\r\nfunction inferPeriodLabels(resultJson, normalizedDays) {\r\n  if (Array.isArray(resultJson?.periods) && resultJson.periods.length > 0) {\r\n    return resultJson.periods;\r\n  }\r\n  if (Array.isArray(resultJson?.periodLabels) && resultJson.periodLabels.length > 0) {\r\n    return resultJson.periodLabels;\r\n  }\r\n  const metaPeriods = resultJson?.meta?.periods;\r\n  if (Array.isArray(metaPeriods) && metaPeriods.length > 0) {\r\n    return metaPeriods;\r\n  }\r\n  const maxPeriods = normalizedDays.reduce(\r\n    (max, day) => Math.max(max, Array.isArray(day.periods) ? day.periods.length : 0),\r\n    0\r\n  );\r\n  if (maxPeriods > 0) {\r\n    return Array.from({ length: maxPeriods }, (_, index) => `P${index + 1}`);\r\n  }\r\n  return DEFAULT_PERIOD_LABELS;\r\n}\r\n\r\nfunction safeText(value, fallback = \"\") {\r\n  if (value === null || value === undefined) return fallback;\r\n  return String(value);\r\n}\r\n\r\nfunction renderCell(slot) {\r\n  if (!slot || Object.keys(slot).length === 0) {\r\n    return \"\";\r\n  }\r\n\r\n  if (slot.isLunch) {\r\n    return `<div style=\"font-weight:600;font-size:12px;color:#b45309;\">Lunch</div>`;\r\n  }\r\n\r\n  if (slot.isFree) {\r\n    return `<div style=\"font-weight:600;font-size:12px;color:#94a3b8;\">Free</div>`;\r\n  }\r\n\r\n  const subject = safeText(slot.subject);\r\n  const teacher = safeText(slot.teacher);\r\n  const room = safeText(slot.room);\r\n\r\n  return `\r\n    ${subject ? `<div style=\"font-weight:600;font-size:12px;color:#0f172a;\">${subject}</div>` : \"\"}\r\n    ${teacher ? `<div style=\"font-size:10px;color:#334155;margin-top:2px;\">${teacher}</div>` : \"\"}\r\n    ${room ? `<div style=\"font-size:10px;color:#475569;margin-top:1px;\">${room}</div>` : \"\"}\r\n  `;\r\n}\r\n\r\nexport function getTimetableHtml(resultJson = {}, division) {\r\n  const sourceRoot =\r\n    (resultJson?.result && typeof resultJson.result === \"object\" ? resultJson.result : null) ||\r\n    (typeof resultJson?.divisions === \"object\" && !Array.isArray(resultJson.divisions)\r\n      ? resultJson.divisions\r\n      : null) ||\r\n    resultJson;\r\n  const resolvedDivision = division || Object.keys(sourceRoot || {})[0] || \"\";\r\n\r\n  const normalizedDays = normalizeDivisionData(resultJson, resolvedDivision);\r\n  const daysOrder = resultJson?.meta?.days || resultJson?.settings?.days || DEFAULT_DAYS;\r\n  const orderedDays = normalizedDays.sort((a, b) => {\r\n    const indexA = daysOrder.indexOf(a.day);\r\n    const indexB = daysOrder.indexOf(b.day);\r\n    if (indexA === -1 && indexB === -1) return a.day.localeCompare(b.day);\r\n    if (indexA === -1) return 1;\r\n    if (indexB === -1) return -1;\r\n    return indexA - indexB;\r\n  });\r\n\r\n  const periodLabels = inferPeriodLabels(resultJson, orderedDays);\r\n\r\n  const instituteName =\r\n    safeText(\r\n      resultJson?.meta?.instituteName ||\r\n        resultJson?.meta?.institute ||\r\n        resultJson?.settings?.institute ||\r\n        \"Smart Timetable Institute\"\r\n    );\r\n  const department =\r\n    safeText(\r\n      resultJson?.meta?.department ||\r\n        resultJson?.meta?.dept ||\r\n        division ||\r\n        \"Department\"\r\n    );\r\n  const academicYear =\r\n    safeText(\r\n      resultJson?.meta?.academicYear ||\r\n        resultJson?.meta?.year ||\r\n        new Date().getFullYear()\r\n    );\r\n  const className =\r\n    safeText(\r\n      resultJson?.meta?.className ||\r\n        resultJson?.meta?.class ||\r\n        division ||\r\n        \"Class\"\r\n    );\r\n  const teacherName = safeText(resultJson?.meta?.classTeacher || \"\");\r\n  const wefDate = formatDateLabel(resultJson?.meta?.wef || resultJson?._generatedAt);\r\n  const revision = formatDateLabel(resultJson?.meta?.revision || resultJson?._updatedAt || resultJson?._generatedAt);\r\n\r\n  const headerSection = `\r\n    <header style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;\">\r\n      <div>\r\n        <div style=\"font-size:22px;font-weight:700;color:#0f172a;margin-bottom:4px;\">${instituteName}</div>\r\n        <div style=\"font-size:13px;color:#475569;\">Academic Timetable (${division})</div>\r\n      </div>\r\n      <div style=\"display:flex;align-items:center;gap:12px;\">\r\n        <div style=\"width:64px;height:64px;border:1px dashed #94a3b8;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:11px;color:#94a3b8;\">\r\n          Logo\r\n        </div>\r\n        <div style=\"text-align:right;\">\r\n          <div style=\"font-size:12px;color:#475569;\">Generated: ${formatDateLabel(resultJson?._generatedAt)}</div>\r\n          <div style=\"font-size:12px;color:#475569;\">Revision: ${revision}</div>\r\n        </div>\r\n      </div>\r\n    </header>\r\n  `;\r\n\r\n  const metadataSection = `\r\n    <section style=\"display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:12px;font-size:12px;color:#0f172a;margin-bottom:18px;\">\r\n      <div style=\"background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;\">\r\n        <div style=\"font-size:10px;text-transform:uppercase;color:#94a3b8;letter-spacing:0.08em;\">Department</div>\r\n        <div style=\"font-weight:600;margin-top:4px;\">${department}</div>\r\n      </div>\r\n      <div style=\"background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;\">\r\n        <div style=\"font-size:10px;text-transform:uppercase;color:#94a3b8;letter-spacing:0.08em;\">Academic Year</div>\r\n        <div style=\"font-weight:600;margin-top:4px;\">${academicYear}</div>\r\n      </div>\r\n      <div style=\"background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;\">\r\n        <div style=\"font-size:10px;text-transform:uppercase;color:#94a3b8;letter-spacing:0.08em;\">Class</div>\r\n        <div style=\"font-weight:600;margin-top:4px;\">${className}</div>\r\n      </div>\r\n      <div style=\"background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;\">\r\n        <div style=\"font-size:10px;text-transform:uppercase;color:#94a3b8;letter-spacing:0.08em;\">Class Teacher</div>\r\n        <div style=\"font-weight:600;margin-top:4px;\">${teacherName || \"-\"}</div>\r\n      </div>\r\n      <div style=\"background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;\">\r\n        <div style=\"font-size:10px;text-transform:uppercase;color:#94a3b8;letter-spacing:0.08em;\">W.E.F Date</div>\r\n        <div style=\"font-weight:600;margin-top:4px;\">${wefDate}</div>\r\n      </div>\r\n    </section>\r\n  `;\r\n\r\n  const tableHeaderCells = periodLabels\r\n    .map(\r\n      (label) => `\r\n        <th style=\"background:#0f172a;color:#e2e8f0;font-size:12px;font-weight:600;padding:10px;border:1px solid #e2e8f0;\">\r\n          ${label}\r\n        </th>\r\n      `\r\n    )\r\n    .join(\"\");\r\n\r\n  const tableRows = orderedDays\r\n    .map(({ day, periods }) => {\r\n      const cells = periodLabels.map((_, idx) => {\r\n        const slot = periods?.[idx] || null;\r\n        const lunchStyles = slot?.isLunch ? \"background:#fef3c7;\" : \"\";\r\n        return `<td style=\"border:1px solid #e2e8f0;padding:8px;min-width:110px;vertical-align:top;${lunchStyles}\">${renderCell(\r\n          slot\r\n        )}</td>`;\r\n      });\r\n\r\n      return `\r\n        <tr>\r\n          <td style=\"border:1px solid #e2e8f0;background:#f8fafc;font-weight:600;padding:10px;min-width:90px;\">\r\n            ${safeText(day)}\r\n          </td>\r\n          ${cells.join(\"\")}\r\n        </tr>\r\n      `;\r\n    })\r\n    .join(\"\");\r\n\r\n  const timetableTable = `\r\n    <table style=\"width:100%;border-collapse:collapse;table-layout:fixed;font-family:'Segoe UI', 'Helvetica Neue', sans-serif;\">\r\n      <thead>\r\n        <tr>\r\n          <th style=\"background:#0f172a;color:#e2e8f0;font-size:12px;font-weight:600;padding:10px;border:1px solid #e2e8f0;min-width:90px;\">Days</th>\r\n          ${tableHeaderCells}\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${\r\n          tableRows ||\r\n          `<tr><td colspan=\"${\r\n            periodLabels.length + 1\r\n          }\" style=\"text-align:center;padding:24px;border:1px solid #e2e8f0;color:#94a3b8;\">No timetable data available for this division.</td></tr>`\r\n        }\r\n      </tbody>\r\n    </table>\r\n  `;\r\n\r\n  return `\r\n    <!DOCTYPE html>\r\n    <html lang=\"en\">\r\n      <head>\r\n        <meta charset=\"UTF-8\" />\r\n        <title>${instituteName} - ${division} Timetable</title>\r\n      </head>\r\n      <body style=\"font-family:'Segoe UI','Helvetica Neue',sans-serif;margin:0;padding:32px;background:#ffffff;color:#0f172a;\">\r\n        ${headerSection}\r\n        ${metadataSection}\r\n        ${timetableTable}\r\n        <footer style=\"margin-top:24px;font-size:10px;color:#94a3b8;text-align:right;\">\r\n          Generated via Smart Timetable Scheduler â€¢ ${formatDateLabel(resultJson?._generatedAt)}\r\n        </footer>\r\n      </body>\r\n    </html>\r\n  `;\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"sources":["file:///D:/Timetable%20Project/app/api/timetable/%5Bid%5D/pdf/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport puppeteer from \"puppeteer\";\r\nimport { connectToDatabase } from \"../../../../../lib/db\";\r\nimport Timetable from \"../../../../../models/Timetable\";\r\nimport { getTimetableHtml } from \"../../../../../lib/timetablePdf\";\r\n\r\nexport async function GET(request, { params }) {\r\n  const resolvedParams = await params;\r\n  const { id } = resolvedParams || {};\r\n  const searchParams = new URL(request.url).searchParams;\r\n  const division = searchParams.get(\"division\");\r\n\r\n  if (!id) {\r\n    return NextResponse.json({ message: \"Timetable id is required\" }, { status: 400 });\r\n  }\r\n\r\n  if (!division) {\r\n    return NextResponse.json({ message: \"Query parameter 'division' is required\" }, { status: 400 });\r\n  }\r\n\r\n  await connectToDatabase();\r\n  const timetableDoc = await Timetable.findById(id);\r\n\r\n  if (!timetableDoc) {\r\n    return NextResponse.json({ message: \"Timetable not found\" }, { status: 404 });\r\n  }\r\n\r\n  const timetablePayload =\r\n    timetableDoc.result && Object.keys(timetableDoc.result).length > 0\r\n      ? timetableDoc.result\r\n      : timetableDoc.data || {};\r\n\r\n  const resultJson = {\r\n    ...JSON.parse(JSON.stringify(timetablePayload)),\r\n    _generatedAt: timetableDoc.generatedAt,\r\n    _updatedAt: timetableDoc.updatedAt,\r\n  };\r\n\r\n  const html = getTimetableHtml(resultJson, division);\r\n\r\n  let browser;\r\n  try {\r\n    browser = await puppeteer.launch({\r\n      headless: \"new\",\r\n      args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"],\r\n    });\r\n    const page = await browser.newPage();\r\n    await page.setContent(html, { waitUntil: \"networkidle0\" });\r\n    const pdfBuffer = await page.pdf({\r\n      format: \"A4\",\r\n      landscape: true,\r\n      printBackground: true,\r\n      margin: { top: \"12mm\", right: \"12mm\", bottom: \"16mm\", left: \"12mm\" },\r\n    });\r\n\r\n    await browser.close();\r\n\r\n    return new NextResponse(pdfBuffer, {\r\n      status: 200,\r\n      headers: {\r\n        \"Content-Type\": \"application/pdf\",\r\n        \"Content-Disposition\": `attachment; filename=\"timetable-${division}.pdf\"`,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    if (browser) {\r\n      await browser.close();\r\n    }\r\n    console.error(\"[Timetable PDF] generation failed:\", error);\r\n    return NextResponse.json(\r\n      { message: \"Failed to generate PDF\", error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;AAEO,eAAe,IAAI,OAAO,EAAE,EAAE,MAAM,EAAE;IAC3C,MAAM,iBAAiB,MAAM;IAC7B,MAAM,EAAE,EAAE,EAAE,GAAG,kBAAkB,CAAC;IAClC,MAAM,eAAe,IAAI,IAAI,QAAQ,GAAG,EAAE,YAAY;IACtD,MAAM,WAAW,aAAa,GAAG,CAAC;IAElC,IAAI,CAAC,IAAI;QACP,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAClF;IAEA,IAAI,CAAC,UAAU;QACb,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAyC,GAAG;YAAE,QAAQ;QAAI;IAChG;IAEA,MAAM,IAAA,gIAAiB;IACvB,MAAM,eAAe,MAAM,gIAAS,CAAC,QAAQ,CAAC;IAE9C,IAAI,CAAC,cAAc;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC7E;IAEA,MAAM,mBACJ,aAAa,MAAM,IAAI,OAAO,IAAI,CAAC,aAAa,MAAM,EAAE,MAAM,GAAG,IAC7D,aAAa,MAAM,GACnB,aAAa,IAAI,IAAI,CAAC;IAE5B,MAAM,aAAa;QACjB,GAAG,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC,kBAAkB;QAC/C,cAAc,aAAa,WAAW;QACtC,YAAY,aAAa,SAAS;IACpC;IAEA,MAAM,OAAO,IAAA,yIAAgB,EAAC,YAAY;IAE1C,IAAI;IACJ,IAAI;QACF,UAAU,MAAM,6HAAS,CAAC,MAAM,CAAC;YAC/B,UAAU;YACV,MAAM;gBAAC;gBAAgB;aAA2B;QACpD;QACA,MAAM,OAAO,MAAM,QAAQ,OAAO;QAClC,MAAM,KAAK,UAAU,CAAC,MAAM;YAAE,WAAW;QAAe;QACxD,MAAM,YAAY,MAAM,KAAK,GAAG,CAAC;YAC/B,QAAQ;YACR,WAAW;YACX,iBAAiB;YACjB,QAAQ;gBAAE,KAAK;gBAAQ,OAAO;gBAAQ,QAAQ;gBAAQ,MAAM;YAAO;QACrE;QAEA,MAAM,QAAQ,KAAK;QAEnB,OAAO,IAAI,gJAAY,CAAC,WAAW;YACjC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,uBAAuB,CAAC,gCAAgC,EAAE,SAAS,KAAK,CAAC;YAC3E;QACF;IACF,EAAE,OAAO,OAAO;QACd,IAAI,SAAS;YACX,MAAM,QAAQ,KAAK;QACrB;QACA,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAA0B,OAAO,MAAM,OAAO;QAAC,GAC1D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}